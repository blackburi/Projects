
# 쿠버네티스란?

![image-3.png](./image-3.png)

- 쿠버네티스(Kubernetes)는 컨테이너화된 애플리케이션을 자동으로 배포, 관리, 확장할 수 있게 도와주는 오픈 소스 플랫폼
    - 컨테이너 오케스트레이션: 여러 컨테이너를 클러스터로 묶어 관리하고, 이를 통해 애플리케이션의 가용성과 확장성을 보장합니다.
    - 자동화된 배포 및 롤백: 애플리케이션 업데이트를 자동으로 배포하고, 문제가 발생하면 자동으로 롤백할 수 있습니다.
    - 서비스 디스커버리 및 로드 밸런싱: 애플리케이션 트래픽을 적절히 분배해줌으로써 안정적인 서비스 운영을 지원합니다.
    - 자동화된 복구: 장애가 발생한 컨테이너를 자동으로 재시작하고, 클러스터의 상태를 지속적으로 모니터링하여 복구 작업을 수행합니다.
    - 스케일링: 애플리케이션의 부하에 따라 컨테이너 수를 자동으로 늘리거나 줄일 수 있습니다.


- 간단한 개념:
    - 클러스터: 여러 대의 서버(노드)를 하나의 그룹으로 묶어 애플리케이션을 실행하는 환경.
    - 노드: 컨테이너가 실제로 실행되는 서버.
    - 파드(Pod): 하나 이상의 컨테이너를 포함하는 가장 작은 배포 단위.
    - 서비스(Service): 파드에 대한 네트워크 접근을 관리하는 논리적 단위.


- 컨테이너 오케이스트레이션은 컨테이너의 프로비저닝, 배포, 네트워킹, 확장, 가용성, 라이프사이클 관리를 자동화합니다. 


- 자동화된 배포:

    - Rolling Update: 쿠버네티스는 애플리케이션의 새 버전을 배포할 때, 기존 버전의 파드를 순차적으로 교체합니다. 이를 "롤링 업데이트(Rolling Update)"라고 합니다. 쿠버네티스는 새 버전의 파드를 조금씩 생성하고, 기존 파드를 하나씩 제거하며 트래픽을 새 파드로 분산시킵니다. 이 과정에서 다운타임을 최소화할 수 있습니다.
    - Canary Deployment: 일부 파드에만 새로운 버전을 배포하여 테스트하고, 문제가 없으면 전체에 배포하는 방식입니다. 쿠버네티스 자체적으로 이 기능을 지원하지는 않지만, 여러 툴과의 연동을 통해 쉽게 구현할 수 있습니다.
자동 롤백:

- 실패 감지: 새로운 버전의 파드를 배포하는 과정에서 문제가 발생하면(예: 파드가 제대로 실행되지 않거나, 헬스체크 실패 등) 쿠버네티스는 자동으로 배포를 중단하고, 이전 안정적인 버전으로 롤백합니다.
- 즉시 복구: 롤백은 자동으로 이전 버전의 파드를 다시 배포하고, 새 버전에서 발생한 문제를 해결한 후에 다시 배포할 수 있도록 합니다.



### 서비스 디스커버리 및 로드 밸런싱
쿠버네티스의 서비스 디스커버리와 로드 밸런싱 기능은 트래픽을 각 파드로 적절히 분배하여 애플리케이션의 안정성을 유지하는 데 중요한 역할을 합니다. 이 부분을 자세히 설명하면

- 서비스 디스커버리:

    - 쿠버네티스에서는 파드가 생성되고 삭제될 때마다 IP 주소가 변경될 수 있습니다. 하지만 서비스(쿠버네티스의 논리적 개념)라는 추상화를 통해, 클러스터 내의 다른 파드들이 특정 파드를 찾아 접근할 수 있게 합니다. 서비스는 고정된 IP와 DNS 이름을 제공하여, 파드 간의 통신을 안정적으로 유지하게 합니다.
이 기능 덕분에 애플리케이션은 동적으로 변화하는 파드들의 위치를 추적할 필요 없이, 항상 서비스 이름으로 접근할 수 있습니다.
- 로드 밸런싱:

    - 쿠버네티스의 서비스는 클러스터 내의 모든 파드에 대해 로드 밸런싱을 제공합니다. 즉, 서비스에 도착한 트래픽은 해당 서비스에 연결된 파드들로 자동으로 분배됩니다. 이를 통해 특정 파드에 트래픽이 집중되는 것을 방지하고, 애플리케이션의 성능과 안정성을 높일 수 있습니다.
쿠버네티스 내부의 기본 로드 밸런싱 기능은 L4(TCP/UDP) 레벨에서 동작합니다. L7(HTTP/HTTPS) 레벨 로드 밸런싱이 필요한 경우, Ingress와 같은 리소스를 사용하여 Nginx 또는 다른 외부 로드 밸런서를 연동할 수 있습니다.

### Nginx나 스프링 클라우드를 사용하지 않아도 되는지?

- Nginx: 쿠버네티스는 기본적으로 L4 로드 밸런싱을 제공하지만, L7 레벨의 고급 라우팅이나 HTTPS 종단(terminate) 등의 기능이 필요한 경우에는 Ingress Controller(Nginx, Traefik 등)와 같은 외부 로드 밸런서가 필요할 수 있습니다. 따라서, 단순한 트래픽 분배를 위해서는 Nginx 없이도 충분하지만, 복잡한 HTTP 라우팅이나 보안 설정이 필요한 경우 Nginx와 같은 솔루션이 필요할 수 있습니다.

- 스프링 클라우드: 스프링 클라우드는 마이크로서비스 간의 복잡한 통신 패턴, 서비스 디스커버리, 설정 관리 등을 관리하는 데 유용합니다. 쿠버네티스는 자체적으로도 서비스 디스커버리와 로드 밸런싱을 제공하지만, 스프링 클라우드의 다양한 기능(예: API 게이트웨이, 서킷 브레이커, 설정 관리 등)을 활용하고 싶다면 스프링 클라우드를 사용할 수 있습니다. 쿠버네티스와 스프링 클라우드는 상호 보완적으로 사용할 수 있습니다.
